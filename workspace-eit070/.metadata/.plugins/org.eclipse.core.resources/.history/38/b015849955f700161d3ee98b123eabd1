/*
 * AssemblyImplementation.S
 *
 *  Created on: 20 feb. 2017
 *      Author: dic14eh2
 */

.global readSwitches_writeLed_Assembly
.text
.ent readSwitches_writeLed_Assembly
readSwitches_writeLed_Assembly:
		lwi r11,r0, 0x40020000
		swi r11,r0, 0x40010000
		rtsd r15,8
		nop
.end readSwitches_writeLed_Assembly

.global function
.text
.ent function
function:
		addi r1,r1,-4
		swi r15,r1,0
		lwi r5,r0, 0x40020000
		brlid r15, number_of_ones
		nop
		add r5,r3,r0
		brlid r15,translateN
		nop
		swi r3,r0,0x40010000
		lwi r15,r1,0
		addi r1,r1,4
		rtsd r15, 8
		nop
.end function

.global number_of_ones
.text
.ent number_of_ones
number_of_ones:
		add r3,r0,r0
while: 	beqid r5, result
		nop
		andi r4,r5,1
		add r3,r3,r4
		sra r5,r5
		brid while
		nop
result: rtsd r15, 8
		nop
.end number_of_ones

.global translateN
.text
.ent translateN
translateN:
		addi r3,r0,1
again: 	beqid r5, done
		nop
		addi r5,r5,-1
		add r3,r3,r3
		brid again
		nop
done: 	addi r3,r3,-1
		rtsd r15, 8
		nop
.end translateN

.global process_switches
.text
.ent process_switches
process_switches:
			addi r1,r1,-4
			sw r15,r1,r0
			lwi r6,r0, 0x40020000
			add r5,r0,r0
			addi r7,r0,8
			addi r10,r0,1
shift: 		beqi r7, arg_ready
			nop
			andi r9, r6,1
			add r5,r5,r5
			add r5,r5,r9
			sra r6,r6
			rsub r7,r10,r7
			brid shift
			nop
arg_ready: 	brlid r15, number_of_ones
			nop
			add r7,r3,r0
			add r5,r6,r0
			brlid r15, first_position_of_one
			nop
			add r6,r3,r0
			add r5,r7,r0
			brlid r15, display_value_at_index
			nop
			lw r15,r1,r0
			addi r1,r1,4
			rtsd r15, 8
			nop
.end process_switches



